# ============================================================================
# OPAS PRODUCTION ENVIRONMENT CONFIGURATION
# Phase 6: Production Deployment
# 
# CORE PRINCIPLE: Security - Secure configuration management
# Store sensitive values in environment variables, never commit to Git
# ============================================================================

# ============================================================================
# 1. DJANGO CORE SETTINGS
# ============================================================================

DEBUG=false
SECRET_KEY=your-secret-key-here-generate-with-secrets.token_urlsafe(32)
ENVIRONMENT=production
ALLOWED_HOSTS=opas.com,www.opas.com,api.opas.com,127.0.0.1,localhost

# ============================================================================
# 2. DATABASE CONFIGURATION (PostgreSQL)
# ============================================================================

DB_ENGINE=django.db.backends.postgresql
DB_NAME=opas_production
DB_USER=opas_user
DB_PASSWORD=your-secure-postgres-password-here
DB_HOST=postgres
DB_PORT=5432

# Connection pooling (pgBouncer)
PGBOUNCER_HOST=pgbouncer
PGBOUNCER_PORT=6432
PGBOUNCER_POOL_MODE=transaction
PGBOUNCER_MAX_CLIENT_CONN=1000
PGBOUNCER_DEFAULT_POOL_SIZE=25

# ============================================================================
# 3. REDIS CACHE CONFIGURATION
# ============================================================================

REDIS_URL=redis://redis:6379/1
REDIS_CACHE_TIMEOUT=300
REDIS_SOCKET_CONNECT_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5

# ============================================================================
# 4. JWT TOKEN CONFIGURATION
# ============================================================================

JWT_SECRET_KEY=your-jwt-secret-key-here
JWT_ACCESS_TOKEN_LIFETIME=86400  # 24 hours in seconds
JWT_REFRESH_TOKEN_LIFETIME=604800  # 7 days
JWT_ALGORITHM=HS256

# ============================================================================
# 5. HTTPS/TLS SECURITY
# ============================================================================

SECURE_SSL_REDIRECT=true
SESSION_COOKIE_SECURE=true
CSRF_COOKIE_SECURE=true
SECURE_HSTS_SECONDS=31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS=true
SECURE_HSTS_PRELOAD=true
X_FRAME_OPTIONS=DENY
SECURE_CONTENT_TYPE_NOSNIFF=true
SECURE_BROWSER_XSS_FILTER=true

# SSL Certificate paths (mount in Docker)
SSL_CERT_PATH=/etc/nginx/ssl/cert.pem
SSL_KEY_PATH=/etc/nginx/ssl/key.pem
SSL_CHAIN_PATH=/etc/nginx/ssl/chain.pem

# ============================================================================
# 6. RATE LIMITING CONFIGURATION
# ============================================================================

# Seller registration: 5 per hour
RATE_LIMIT_SELLER_REGISTRATION=5/h

# Admin approval: 60 per hour
RATE_LIMIT_ADMIN_APPROVAL=60/h

# Admin list: 100 per hour
RATE_LIMIT_ADMIN_LIST=100/h

# Login attempts: 10 per hour
RATE_LIMIT_LOGIN=10/h

# Token refresh: 100 per hour
RATE_LIMIT_TOKEN_REFRESH=100/h

# ============================================================================
# 7. LOGGING CONFIGURATION
# ============================================================================

LOG_DIR=/var/log/opas/
LOG_LEVEL=INFO
LOG_FILE_MAX_BYTES=10485760  # 10MB
LOG_FILE_BACKUP_COUNT=10

# Sentry integration (optional - for error tracking)
SENTRY_DSN=

# ============================================================================
# 8. EMAIL CONFIGURATION (for notifications)
# ============================================================================

EMAIL_BACKEND=django.core.mail.backends.smtp.EmailBackend
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USE_TLS=true
EMAIL_HOST_USER=your-email@gmail.com
EMAIL_HOST_PASSWORD=your-app-password-here
DEFAULT_FROM_EMAIL=noreply@opas.com

# ============================================================================
# 9. AWS S3 CONFIGURATION (for media storage)
# ============================================================================

USE_S3=true
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_STORAGE_BUCKET_NAME=opas-production-media
AWS_S3_REGION_NAME=us-east-1
AWS_S3_CUSTOM_DOMAIN=${AWS_STORAGE_BUCKET_NAME}.s3.amazonaws.com
AWS_DEFAULT_ACL=public-read
AWS_S3_OBJECT_PARAMETERS={'CacheControl': 'max-age=86400'}

# ============================================================================
# 10. CORS CONFIGURATION
# ============================================================================

CORS_ALLOWED_ORIGINS=https://opas.com,https://www.opas.com,https://api.opas.com
CORS_ALLOW_CREDENTIALS=true

# ============================================================================
# 11. MONITORING & ALERTING
# ============================================================================

# Health check endpoint
HEALTH_CHECK_URL=http://localhost:8000/health/
HEALTH_CHECK_TIMEOUT=5

# Prometheus metrics
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=8001

# ============================================================================
# 12. PERFORMANCE TUNING
# ============================================================================

# Cache settings
CACHE_HITS_TARGET=85
CACHE_TTL_REGISTRATION=1800  # 30 minutes
CACHE_TTL_ADMIN_LIST=300     # 5 minutes
CACHE_TTL_USER_PROFILE=3600  # 1 hour

# Query optimization
SELECT_RELATED_ENABLED=true
PREFETCH_RELATED_ENABLED=true
QUERY_TIMEOUT_MS=30000

# Response compression
GZIP_ENABLED=true
GZIP_LEVEL=6
GZIP_MIN_LENGTH_BYTES=1000

# ============================================================================
# 13. GUNICORN CONFIGURATION
# ============================================================================

GUNICORN_WORKERS=4
GUNICORN_THREADS=2
GUNICORN_WORKER_TIMEOUT=30
GUNICORN_ACCESS_LOG=-
GUNICORN_ERROR_LOG=-
GUNICORN_LOG_LEVEL=info

# ============================================================================
# 14. DEVELOPMENT/STAGING OVERRIDES
# ============================================================================

# Uncomment for staging:
# ENVIRONMENT=staging
# DEBUG=true
# SECURE_SSL_REDIRECT=false
# SECURE_HSTS_SECONDS=0

# Uncomment for development:
# ENVIRONMENT=development
# DEBUG=true
# SECURE_SSL_REDIRECT=false
# CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:8000

# ============================================================================
# CHECKLIST FOR DEPLOYMENT
# ============================================================================

"""
‚úÖ ENVIRONMENT SETUP CHECKLIST:

Before deploying to production:

1. Database:
   ‚òê Update DB_PASSWORD with secure password
   ‚òê Backup existing database
   ‚òê Verify PostgreSQL version is 13+
   ‚òê Configure pgBouncer connection pooling
   ‚òê Test database connections

2. Security:
   ‚òê Generate new SECRET_KEY (secrets.token_urlsafe(32))
   ‚òê Generate new JWT_SECRET_KEY
   ‚òê Update ALLOWED_HOSTS with actual domains
   ‚òê Install SSL certificates (cert.pem, key.pem)
   ‚òê Enable SECURE_SSL_REDIRECT

3. Cache:
   ‚òê Start Redis instance
   ‚òê Set REDIS_URL to production Redis
   ‚òê Test cache connectivity
   ‚òê Configure cache TTLs

4. Rate Limiting:
   ‚òê Review rate limits for production usage
   ‚òê Adjust RATE_LIMIT_* values if needed
   ‚òê Test throttle behavior

5. Logging:
   ‚òê Create /var/log/opas/ directory
   ‚òê Set appropriate permissions
   ‚òê Configure log rotation
   ‚òê Setup Sentry if using error tracking

6. Email:
   ‚òê Configure EMAIL_HOST_USER
   ‚òê Generate app-specific password
   ‚òê Test email sending

7. Storage:
   ‚òê Setup AWS S3 bucket (if using)
   ‚òê Configure AWS credentials
   ‚òê Test file uploads

8. Monitoring:
   ‚òê Enable health checks
   ‚òê Setup Prometheus metrics
   ‚òê Configure alerting thresholds
   ‚òê Test alert notifications

9. Deployment:
   ‚òê Build Docker images
   ‚òê Run migrations
   ‚òê Collect static files
   ‚òê Warm cache
   ‚òê Run load tests
   ‚òê Monitor initial traffic

10. Verification:
    ‚òê Verify all endpoints responding
    ‚òê Check cache hit rates (target 85%+)
    ‚òê Monitor response times (target <200ms)
    ‚òê Verify rate limiting working
    ‚òê Test token expiration/refresh
    ‚òê Confirm HTTPS enforcement
    ‚òê Review security headers
"""

# ============================================================================
# SECURITY NOTES
# ============================================================================

"""
üîí SECURITY IMPORTANT:

1. NEVER commit this file with actual passwords to Git
2. Use .env file locally (add to .gitignore)
3. Use environment variables in production (Docker secrets, k8s secrets)
4. Rotate secrets regularly
5. Use strong passwords (32+ characters for database)
6. Keep SSL certificates current
7. Monitor for suspicious activity
8. Review logs regularly
9. Update dependencies monthly
10. Run security audits quarterly
"""
